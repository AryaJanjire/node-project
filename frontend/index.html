<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <title>Portfolio</title>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class = "text-center mb-4">Portfolio</h2>
        <form id="userForm" class="mb-4">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" class="form-control" name = "name" id="name" placeholder="Enter your Name" required>
                </div>

                <div class="col-md-4">
                    <input type="email" class="form-control" name="email" id="email" placeholder="Enter your Email" required>
                </div>

                <div class="col-md-3">
                    <!-- <input type="submit" class="btn btn-primary" value="Submit" id="submitBtn"> -->
                    <button type="submit" class="btn btn-dark">Add User</button>
                </div>
            </div>
        </form>

        <table class="table table-striped table-bordered" id="userTable">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id = "userTableBody">
                <!-- User rows will be added here dynamically -->
            </tbody>
        </table>
        </div>
        <script>
            const apiUrl = 'http://localhost:3000/api/v1/users'

            window.onload = fetchUsers;
            async function fetchUsers(){
                const res = await fetch(apiUrl);
                const users = await res.json();
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = '';

                users.forEach(user=>{
                    tbody.innerHTML+=
                    `<tr>
                        <td>${user.id}</td>
                        <td><input type = "text" class="form-control" value="${user.name}" id="name-${user.id}"></td>
                        <td><input type = "email" class="form-control" value="${user.email}" id="email-${user.id}"></td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="updateUser(${user.id})">Update</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">Delete</button>
                        </td>
                    </tr>`;
                })
            }

            //handle form submission
            document.getElementById("userForm").addEventListener('submit', async function(err){
                err.preventDefault();
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const res = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email })
                });
                const resu = await res.json();
                alert(resu.message);
                document.getElementById('userForm').reset();
                fetchUsers();

            })

            //delete
            async function deleteUser(id){
                if(!confirm("Are u sure u want to delete this user?"))return;
                const res = await fetch(`${apiUrl}/${id}`, {
                    method: 'DELETE'
                });
                const resu = await res.json();
                alert(resu.message);
                fetchUsers();
            }

            //update
            async function updateUser(id){
                // const name = prompt("Enter new name:");
                // const email = prompt("enter new email: "); 
                // if(!name || !email)return;
                //const res = await fetch(`${apiUrl}/${id}`, {
                  //  method: 'PUT',
                   // headers: {
                    //    'Content-Type': 'application/json'
                    //},
                    //body: JSON.stringify({ name, email })
                //});
                const name = document.getElementById(`name-${id}`).value;
                const email = document.getElementById(`email-${id}`).value;
                if(!name || !email) return;
                const res = await fetch(`${apiUrl}/${id}`, {
                   method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email })
                });
                const resu = await res.json();
                alert(resu.message);
                fetchUsers();
            }
        </script>


    </div>
    

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
      
</body>
</html>